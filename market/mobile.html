<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAX</title>
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/all.css">

  <link rel="stylesheet" type="text/css" href="../css/slick.css"/>
  <link rel="stylesheet" type="text/css" href="../css/slick-theme.css"/>
  <link href="../css/sweetalert2.css" rel="stylesheet" type="text/css">
</head>
<body>
  <div class="loading">
    <img src="../images/MAX_logo.png" alt="">
  </div>
  <!--头部-->
  <header class="header-wrap">
    <a class="navbar-brand header-logo" href="/">
      <img src="../images/MAX%20logo.png" alt="">
    </a>
    <nav class="navbar navbar-expand-lg header py-lg-4 py-2">
      <div class="container-fluid position-relative px-1">
        <img class="navbar-toggler p-0" src="../images/back.png" alt=""
             onclick="javascript:history.back();">
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
             aria-labelledby="offcanvasNavbarLabel">
          <div class="offcanvas-body justify-content-between align-items-center p-0">
            <div class="flex-column">
              <div class="header-info d-lg-block d-none px-2">
                <span class="header-time"></span> ( 北京标准时间 ) ｜ 线上人数 ：<span class="rand"></span>
              </div>
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item d-sm-none d-blck">
                  <a data-bs-toggle="modal" data-bs-target="#loginModal"
                     class="nav-link px-2 pb-0" href="./account">中心钱包</a>
                </li>
                <li class="nav-item">
                  <a data-bs-toggle="modal" data-bs-target="#loginModal"
                     class="nav-link px-2 pb-0" href="./market">市场列表</a>
                </li>
                <li class="nav-item d-sm-none d-blck">
                  <a data-bs-toggle="modal" data-bs-target="#loginModal"
                     class="nav-link px-2 pb-0" href="./trade">存提纪录</a>
                </li>
                <li class="nav-item d-sm-block">
                  <a data-bs-toggle="modal" data-bs-target="#loginModal"
                     class="nav-link px-2 pb-0" href="./investment">投资纪录</a>
                </li>
                <li class="nav-item">
                  <a data-bs-toggle="modal" data-bs-target="#loginModal"
                     class="nav-link px-2 pb-0" href="./match">赛事结果</a>
                </li>

                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="./immediate">即时比分</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="./promotion">优惠活动</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="./announcement">最新消息</a>
                </li>
                <li class="nav-item dropdown d-sm-none d-blck">
                  <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#"
                     role="button" aria-haspopup="true" aria-expanded="false">线上客服</a>
                  <div class="dropdown-menu">
                    <a class="nav-link px-2 pb-0 text-black"
                       href="https://direct.lc.chat/14165448/" target="_blank">线路1</a>
                    <a class="nav-link px-2 pb-0 text-black"
                       href="./service">线路2</a>
                  </div>
                </li>

                <li class="nav-item d-sm-none d-blck">
                  <a class="nav-link px-2 pb-0"
                     href="./mobile/help/rule">规则条款</a>
                </li>
                <li class="nav-item d-sm-none d-blck">
                  <a class="nav-link px-2 pb-0" href="./mobile/help">帮助中心</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <a class="nav-link header-login py-0" href="#" data-bs-toggle="modal"
           data-bs-target="#loginModal">登入</a>
      </div>
    </nav>
  </header>

  <div class="mobile-market text-center px-2">
    <div class="market-refresh my-3">成交量:474,788.64 </div>
    <div class="market-info"> </div>
    <div class="page position-relative market mb-5 pb-5">
      <div class="row m-0 d-flex py-2 align-items-center table-th">
        <div class="col-2">项目</div>
        <div class="col-3">获利%</div>
        <div class="col-3">可成交量</div>
        <div class="col-4"></div>
      </div>

      <div id="page"></div>

      <div class="row m-0 d-flex table-td py-2">
        <div class="col-6 p-0">客队赢进4球(含)以上</div>
      </div>
      <div class="row m-0 d-flex table-td py-2">
        <div class="col-6 p-0">主队赢进4球(含)以上</div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="betModal" tabindex="-1" aria-labelledby="betModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 pb-5 text-center">
        <h1 class="modal-content__title p-3">交易讯息</h1>
        <div>
          <span class="market-main__time"></span>
          <span class="market-main__title"></span><br>
          <span class="market-main__team"></span>
        </div>
        <div class="my-3 modal-bet__info">
          正在<span>反对</span>赛事结果<span>波胆</span><span class="modal-bet-way">0 - 1</span><br>
          手续费 10%
        </div>
        <div class="row m-0 d-flex align-items-center table-th">
          <div class="col-4">金额</div>
          <div class="col-4">获利%</div>
          <div class="col-4">预估获利<br>
            (已扣除手续费)</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td modal-bet__table">
          <div class="col-4 p-0"><input type="number" min="10" class="modal-bet-amount w-100 my-2" placeholder="请输入金额" autocomplete="off"></div>
          <div class="col-4 p-0 modal-bet-ratio">2.42%</div>
          <div class="col-4 p-0 modal-bet-profit">0</div>
        </div>
        <div class="row m-0 mt-3 modal-bet__btns">
          <div class="col-4 p-2">
            <button class="modal-bet__btn" data-amount="100">$ 100</button>
          </div>
          <div class="col-4 p-2">
            <button class="modal-bet__btn" data-amount="1000">$ 1,000</button>
          </div>
          <div class="col-4 p-2">
            <button class="modal-bet__btn" data-amount="0.00">全部</button>
          </div>
        </div>
        <div class="d-flex justify-content-center mt-3">
          <div class="modal-btn mx-2" data-bs-dismiss="modal">取消</div>
          <div class="modal-btn mx-2 modal-next">下一步</div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="betCheckModal" tabindex="-1" aria-labelledby="betCheckModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 pb-5 text-center">
        <form id="bet-form" action="./bet" autocomplete="off">

          <h1 class="modal-content__title p-3">交易确认</h1>
          <div>
            <span class="market-main__time"></span>
            <span class="market-main__title"></span><br>
            <span class="market-main__team"></span>
          </div>
          <div class="my-3 modal-bet__info">
            正在<span>反对</span>赛事结果<span>波胆 <span class="modal-bet-way"></span></span><br>
            手续费 10%
          </div>
          <div class="row m-0 d-flex align-items-center table-th">
            <div class="col-4">金额</div>
            <div class="col-4">获利%</div>
            <div class="col-4">预估获利<br>
              (已扣除手续费)</div>
          </div>
          <div class="row m-0 d-flex align-items-center table-td modal-bet__table">
            <div class="col-4 p-0"><span class="w-100 my-2" id="bet-amount"></span></div>
            <div class="col-4 p-0 modal-bet-ratio"></div>
            <div class="col-4 p-0 modal-bet-profit"></div>
          </div>
          <div class="color-lbp mt-3">*请确认投资内容是否正确*</div>
          <div class="d-flex justify-content-center mt-3">
            <input type="hidden" name="amount" class="bet-amount" value="" autocomplete="off">
            <input type="hidden" name="trasactionId" class="bet-id" value="" autocomplete="off">
            <div class="modal-btn mx-2" data-bs-dismiss="modal">取消</div>
            <button class="modal-btn mx-2">确认</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="betShowModal" tabindex="-1" aria-labelledby="betShowModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 pb-5 text-center">
        <h1 class="modal-content__title p-3"><i class="fa fa-check"></i></h1>

        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">开赛时间</span></div>
          <div class="col-8 py-1">08/09 17:00</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">联盟</span></div>
          <div class="col-8 py-1">国际友谊</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">队伍</span></div>
          <div class="col-8 py-1">马来西亚U19 V.S缅甸U19</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">项目</span></div>
          <div class="col-8 py-1 modal-bet-way">0 - 1</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">金额</span></div>
          <div class="col-8 py-1 show-bet-amount fw-bolder"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">获利率</span></div>
          <div class="col-8 py-1 show-bet-ratio fw-bolder text-danger"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">预估获利 ($)</span></div>
          <div class="col-8 py-1 show-bet-profit fw-bolder text-success fs-3"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">预估获利 (¥)</span></div>
          <div class="col-8 py-1 show-bet-profit-rmb fw-bolder text-success fs-3"></div>
        </div>
        <div class="d-flex justify-content-center mt-3">
          <a class="modal-btn mx-2" href="javascript:location.reload();">关闭</a>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-5"></div>
  <!--    底部三件套-->
  <div class="side-menu-wrap">
    <div class="side-menu d-sm-block d-none">
      <div class="side-menu__btns text-center">
        <a href="../announcement.html" class="side-menu__btn">
          <img src="../images/icon_side-ann.png" alt="">
          <div>网站公告</div>
        </a>
        <a href="https://direct.lc.chat/14165448/" target="_blank" class="side-menu__btn">
          <img src="../images/icon_side-contact.png" alt="">
          <div>线上客服</div>
        </a>

        <a href="../account.html" class="side-menu__btn">
          <img src="../images/icon_side-balance.png" alt="">
          <div>中心钱包</div>
        </a>
        <a href="../mobile/recharge.html" class="side-menu__btn withdrawal">
          <img src="../images/icon_side-withdrawal.png" alt="">
          <div>充值提现</div>
        </a>
      </div>
    </div>
  </div>
  <div class="footer-wrap">
    <footer class="footer text-center py-2 d-sm-block d-none">
      <a href="./help.html" class="footer-link mx-2">帮助中心</a>
      <a href="javascript:location.reload();" class="footer-link mx-2">页面卡顿？</a>
      <div class="float-sm-end pe-4">版权所有 © 2022 MAX</div>
    </footer>
  </div>
  <div class="bottom-menu-wrap">
    <div class="bottom-menu d-sm-none d-block">
      <div class="bottom-menu__btns" style="font-size:0.75rem;">
        <a href="../index.html" class="bottom-menu__btn">
          <img src="../images/icon_side-home.png" alt="">
          <div>首页</div>
        </a>
        <a href="../market.html" class="bottom-menu__btn ">
          <img src="../images/icon_side-list.png" alt="">
          <div>市场列表</div>
        </a>
        <a href="../investment/notopen.html " class="bottom-menu__btn ">
          <img src="../images/icon_trade-history.png" alt="">
          <div>交易明细</div>
        </a>
        <a href="../investment2.html" class="bottom-menu__btn ">
          <img src="../images/icon_side-history.png" alt="">
          <div>历史帐务</div>
        </a>
      </div>
    </div>
  </div>

  <script src="../js/bootstrap.bundle.min.js"></script>
  <script src="../js/jquery-2.2.0.min.js" type="text/javascript"></script>
  <script type="text/javascript" src="../js/slick.min.js"></script>
  <script src="../js/sweetalert2.min.js"></script>
  <script src="../js/moment-with-locales.min.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/clipboard.min.js"></script>
  <script src="../js/imask.js"></script>
  <script src="../js/CLDRPluralRuleParser.js"></script>

  <script>
    $(function() {
      $('.loading').hide();

      var search = location.search;
      var id = search.substring(search.indexOf("=") + 1);
      console.log(id)

      $.ajax({
        type: 'GET',
        url: 'https://www.max68888.com/max/trasaction/getList/'+id,
        xhrFields: {
          withCredentials: true
        },
        success: function(res) {
          console.log(res)
          let item = res.data;
          var text = item.maxStartTime+"\n"+ item.maxGameName+"<br>" +
                  item.maxHomeTeam+"<br>VS<br>"+item.maxCustomerTeam
          $('.market-info').html(text)
          $('.market-refresh').html('成交量:'+item.trasactionSize)

          sorting(item.maxMaskTrasactionList)

          $(".market-main__time").text(item.maxStartTime)
          $(".market-main__title").text(item.maxGameName)
          $(".market-main__team").html( item.maxHomeTeam+"VS"+item.maxCustomerTeam)
        },
      })

      function sorting(data){
        $.each( data, function (i , item){
          var box = 
                  '<div class="row m-0 d-flex table-td py-2">' +
                  '  <div class="col-2 p-0">'+item.maxScore+'</div>' +
                  '  <div class="col-3 p-0">'+item.maxEarn+'%</div>' +
                  '  <div class="col-3 p-0">'+item.maxLimitTrasaction+'</div>' +
                  '  <div class="col-4 p-0">' +
                  '   <button class="back-btn bet-table-button" data-bs-toggle="modal" ' +
                  'data-bs-target="#betModal" data-ratio="'+item.maxEarn+'" data-way="'+item.maxScore+'" ' +
                  'data-bet_id="'+item.id+'">下单</button>'
                  '  </div>' +
                  '</div>'
          $('#page').append(box)
        })

      }

    });
  </script>

  <script>
    var RATIO = 0;
    $(document).on('click', '.bet-table-button', function(){

      // data-ratio="0.01920" data-way="0 - 45646546" data-bet_id="odds-96fa4ff9-df50-462d-b435-90c3ab638f44"

      RATIO = $(this).data('ratio') /100;
      $('.bet-id').val($(this).data('bet_id'));
      $('.modal-bet-ratio').text((RATIO * 100).toFixed(2) + '%');
      $('.modal-bet-way').text($(this).data('way'));
      $('.modal-bet-amount').val('');
      $('.modal-bet-profit').text(0);
    });


    $('.modal-bet__btn').on('click', function(){
      $('.modal-bet-amount').val($(this).data('amount'));
      $('.modal-bet-amount').trigger('change');
    });

    $('.modal-bet-amount').on('change blur',function(){
      var amount = $(this).val();
      if(amount > 0) {
        var profit = 0.9 * RATIO *  amount;
        $('.modal-bet-profit').text("$" + profit.toFixed(2));
        $('#bet-amount').text(amount);
        $('.bet-amount').val(amount);
      } else {
        $(this).val('');
      }
    });
    $('.modal-next').on('click', function(){
      if($('.modal-bet-amount').val() > 0){
        $('#betModal').modal('hide');
        $('#betCheckModal').modal('show');
      } else {
        $('.modal-bet-amount').val('');
        $('.modal-bet-amount').focus();
      }
    });

    $('#bet-form').on('submit', function(e){
      e.preventDefault();
      $('button').attr("disabled", true);
      var form = $(this);
      console.log(form.serialize())

      $.ajax({
        type: 'POST',
        data: form.serialize(),
        url: 'https://www.max68888.com/max/trasactionOrder/pickTrasaction',
        xhrFields: {
          withCredentials: true
        },
        success: function (res) {
          if(res.code == 0){
            console.log(res)

            $('.balance').text(res.balance);
            $('.bill-number').text(res.bill_number);
            $('.show-bet-amount').text(res.amount);
            $('.show-bet-ratio').text(res.ratio);
            $('.show-bet-profit').text(res.profit);
            $('.show-bet-profit-rmb').text((res.profit*7).toFixed(2));

            $('#betCheckModal').modal('hide');
            $('#betShowModal').modal('show');
          }
          else{
            swal(res.message, '', "error");
          }
          $('button').attr("disabled", false);
        }
      });

    });

  </script>
</body>
</html>