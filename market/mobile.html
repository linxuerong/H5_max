<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAX</title>
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/all.css">

  <link rel="stylesheet" type="text/css" href="../css/slick.css"/>
  <link rel="stylesheet" type="text/css" href="../css/slick-theme.css"/>
  <link href="../css/sweetalert2.css" rel="stylesheet" type="text/css">
</head>
<body>
  <div class="loading">
    <img src="../images/MAX_logo.png" alt="">
  </div>
  <!--头部-->
  <header class="header-wrap">
    <a class="navbar-brand header-logo" href="/">
      <img src="../images/MAX_logo.png" alt="">
    </a>
    <nav class="navbar navbar-expand-lg header py-lg-4 py-2">
      <div class="container-fluid position-relative px-1">
        <img class="navbar-toggler p-0" src="../images/back.png" alt=""
             onclick="javascript:history.go(-1);">
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
             aria-labelledby="offcanvasNavbarLabel">
          <div class="offcanvas-body justify-content-between align-items-center p-0">
            <div class="flex-column">
              <div class="header-info d-lg-block d-none px-2">
                <span class="header-time"></span> ( 北京标准时间 ) ｜ 线上人数 ：<span class="rand"></span>
              </div>
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item d-sm-none d-blck">
                  <a class="nav-link px-2 pb-0" href="../account.html">中心钱包</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="../market.html">市场列表</a>
                </li>
                <li class="nav-item d-sm-none d-blck">
                  <a class="nav-link px-2 pb-0" href="../trade.html">存提纪录</a>
                </li>
                <li class="nav-item d-sm-block">
                  <a class="nav-link px-2 pb-0" href="../investment.html">投资纪录</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="../match.html">赛事结果</a>
                </li>

                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="../immediate.html">即时比分</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="../promotion.html">优惠活动</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-2 pb-0" href="../announcement.html">最新消息</a>
                </li>
                <li class="nav-item dropdown d-sm-none d-blck">
                  <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">线上客服</a>
                  <div class="dropdown-menu" >
                    <a class="nav-link px-2 pb-0 text-black onKefu" >线路1</a>
                    <a class="nav-link px-2 pb-0 text-black onKefu" >线路2</a>
                  </div>
                </li>

                <li class="nav-item d-sm-none d-blck">
                  <a class="nav-link px-2 pb-0"
                     href="help/rule.html">规则条款</a>
                </li>
                <li class="nav-item d-sm-none d-blck">
                  <a class="nav-link px-2 pb-0" href="../mobile/help.html">帮助中心</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="text-end">
          <div class="loginShow d-sm-block d-none p-2">
            Hi, <span class="uname"></span>
            <br class="d-sm-none d-blck">
            欢迎
          </div>
          <a class="loginShow nav-link header-login text-end py-0 d-blck pe-2" href="/max/logout">登出</a>
          <a class="loginHide nav-link header-login py-0" href="/index.html">登入</a>
        </div>
      </div>
    </nav>
  </header>

  <div class="mobile-market text-center px-2">
    <div class="market-refresh my-3">成交量: <span id="cjl"></span></div>
    <div class="market-info"> </div>
    <div class="page position-relative market mb-5 pb-5">
      <div class="row m-0 d-flex py-2 align-items-center table-th">
        <div class="col-2">项目</div>
        <div class="col-3">获利%</div>
        <div class="col-3">可成交量</div>
        <div class="col-4"></div>
      </div>

      <div id="page">
      </div>

      <div class="row m-0 d-flex table-td py-2">
        <div class="col-6 p-0">客队赢进4球(含)以上</div>
      </div>
      <div class="row m-0 d-flex table-td py-2">
        <div class="col-6 p-0">主队赢进4球(含)以上</div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="betModal" tabindex="-1" aria-labelledby="betModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 pb-5 text-center">
        <h1 class="modal-content__title p-3">交易讯息</h1>
        <div>
          <span class="market-main__time"></span>
          <span class="market-main__title"></span><br>
          <span class="market-main__team"></span>
        </div>
        <div class="my-3 modal-bet__info">
          正在<span>反对</span>赛事结果<span>波胆</span><span class="modal-bet-way">0 - 1</span><br>
          手续费 10%
        </div>
        <div class="row m-0 d-flex align-items-center table-th">
          <div class="col-4">金额</div>
          <div class="col-4">获利%</div>
          <div class="col-4">预估获利<br>
            (已扣除手续费)</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td modal-bet__table">
          <div class="col-4 p-0"><input type="number" min="10" class="modal-bet-amount w-100 my-2" placeholder="请输入金额" autocomplete="off"></div>
          <div class="col-4 p-0 modal-bet-ratio">2.42%</div>
          <div class="col-4 p-0 modal-bet-profit">0</div>
        </div>
        <div class="row m-0 mt-3 modal-bet__btns">
          <div class="col-4 p-2">
            <button class="modal-bet__btn" data-amount="100">$ 100</button>
          </div>
          <div class="col-4 p-2">
            <button class="modal-bet__btn" data-amount="1000">$ 1,000</button>
          </div>
          <div class="col-4 p-2">
            <button class="modal-bet__btn modal-all" data-amount="100.00">全部</button>
          </div>
        </div>
        <div class="d-flex justify-content-center mt-3">
          <div class="modal-btn mx-2" data-bs-dismiss="modal">取消</div>
          <div class="modal-btn mx-2 modal-next">下一步</div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="betCheckModal" tabindex="-1" aria-labelledby="betCheckModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 pb-5 text-center">
        <form id="bet-form" action="./bet" autocomplete="off">

          <h1 class="modal-content__title p-3">交易确认</h1>
          <div>
            <span class="market-main__time"></span>
            <span class="market-main__title"></span><br>
            <span class="market-main__team"></span>
          </div>
          <div class="my-3 modal-bet__info">
            正在<span>反对</span>赛事结果<span>波胆 <span class="modal-bet-way"></span></span><br>
            手续费 10%
          </div>
          <div class="row m-0 d-flex align-items-center table-th">
            <div class="col-4">金额</div>
            <div class="col-4">获利%</div>
            <div class="col-4">预估获利<br>
              (已扣除手续费)</div>
          </div>
          <div class="row m-0 d-flex align-items-center table-td modal-bet__table">
            <div class="col-4 p-0"><span class="w-100 my-2" id="bet-amount"></span></div>
            <div class="col-4 p-0 modal-bet-ratio"></div>
            <div class="col-4 p-0 modal-bet-profit"></div>
          </div>
          <div class="color-lbp mt-3">*请确认投资内容是否正确*</div>
          <div class="d-flex justify-content-center mt-3">
            <input type="hidden" name="amount" class="bet-amount" value="" autocomplete="off">
            <input type="hidden" name="maxDataId" class="maxDataId" value="" autocomplete="off">
            <div class="modal-btn mx-2" data-bs-dismiss="modal">取消</div>
            <button class="modal-btn mx-2">确认</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="betShowModal" tabindex="-1" aria-labelledby="betShowModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 pb-5 text-center">
        <h1 class="modal-content__title p-3"><i class="fa fa-check"></i></h1>

        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">开赛时间</span></div>
          <div class="col-8 py-1" id="gameStartTime"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">联盟</span></div>
          <div class="col-8 py-1" id="maxCustomerTeam"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">队伍</span></div>
          <div class="col-8 py-1" id="maxGame"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">项目</span></div>
          <div class="col-8 py-1 modal-bet-way" id="maxScore">0 - 0</div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">金额</span></div>
          <div class="col-8 py-1 show-bet-amount fw-bolder" id="amount"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">获利率</span></div>
          <div class="col-8 py-1 show-bet-ratio fw-bolder text-danger" id="maxEarn"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">预估获利 ($)</span></div>
          <div class="col-8 py-1 show-bet-profit fw-bolder text-success fs-3" id="resultEarn"></div>
        </div>
        <div class="row m-0 d-flex align-items-center table-td">
          <div class="col-4 py-1"><span class="badge rounded-pill bg-primary w-100">预估获利 (¥)</span></div>
          <div class="col-8 py-1 show-bet-profit-rmb fw-bolder text-success fs-3" id="resultRem"></div>
        </div>
        <div class="d-flex justify-content-center mt-3">
          <a class="modal-btn mx-2" href="javascript:location.reload();">关闭</a>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-5"></div>
  <!--    底部三件套-->
  <div class="side-menu-wrap">
    <div class="side-menu d-sm-block d-none">
      <div class="side-menu__btns text-center">
        <a href="../announcement.html" class="side-menu__btn">
          <img src="../images/icon_side-ann.png" alt="">
          <div>网站公告</div>
        </a>
        <a class="side-menu__btn onKefu">
          <img src="../images/icon_side-contact.png" alt="">
          <div>线上客服</div>
        </a>

        <a href="../account.html" class="side-menu__btn">
          <img src="../images/icon_side-balance.png" alt="">
          <div>中心钱包</div>
        </a>
        <a href="../mobile/recharge.html" class="side-menu__btn withdrawal">
          <img src="../images/icon_side-withdrawal.png" alt="">
          <div>充值提现</div>
        </a>
      </div>
    </div>
  </div>
  <div class="footer-wrap">
    <footer class="footer text-center py-2 d-sm-block d-none">
      <a href="./help.html" class="footer-link mx-2">帮助中心</a>
      <a href="javascript:location.reload();" class="footer-link mx-2">页面卡顿？</a>
      <div class="float-sm-end pe-4">版权所有 © 2022 MAX</div>
    </footer>
  </div>
  <div class="bottom-menu-wrap">
    <div class="bottom-menu d-sm-none d-block">
      <div class="bottom-menu__btns" style="font-size:0.75rem;">
        <a href="../index.html" class="bottom-menu__btn">
          <img src="../images/icon_side-home.png" alt="">
          <div>首页</div>
        </a>
        <a href="../market.html" class="bottom-menu__btn ">
          <img src="../images/icon_side-list.png" alt="">
          <div>市场列表</div>
        </a>
        <a href="../investment/notopen.html " class="bottom-menu__btn ">
          <img src="../images/icon_trade-history.png" alt="">
          <div>交易明细</div>
        </a>
        <a href="../investment2.html" class="bottom-menu__btn ">
          <img src="../images/icon_side-history.png" alt="">
          <div>历史帐务</div>
        </a>
      </div>
    </div>
  </div>

  <script src="../js/bootstrap.bundle.min.js"></script>
  <script src="../js/jquery-2.2.0.min.js" type="text/javascript"></script>
  <script type="text/javascript" src="../js/slick.min.js"></script>
  <script src="../js/sweetalert2.min.js"></script>
  <script src="../js/moment-with-locales.min.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/clipboard.min.js"></script>
  <script src="../js/imask.js"></script>
  <script src="../js/CLDRPluralRuleParser.js"></script>

  <script>

    $(function() {
      $('.loading').hide();

      $.ajax({
        type: 'GET',
        url: 'https://www.max68888.com/max/member/getInfo',
        xhrFields: {
          withCredentials: true
        },
        success: function(res) {
          $('.loading').hide();
          if(res.code == 0){
            // 成功
            console.log(res.data)
            $('.uname').html(res.data.maxNickName)
            $('.uAccount').html(res.data.maxAccount)
            $('.uLevel').html(res.data.maxLevel)

            $('.uBalance').html(res.data.balance.toFixed(2))
            $(".modal-all").attr('data-amount',res.data.balance )
            $(".loginHide").remove();

          }else {
            //没有登录
            $('.loginShow').remove();
          }
        },
      })

    });

  </script>

  <script>
    $(function() {
      var Tx = 90000000;
      var Ty = 60000000;
      var rand = parseInt(Math.random() * (Tx - Ty + 1) + Ty);

      $("#cjl").text(Number(rand / 100).toLocaleString())


      var search = location.search;
      var id = search.substring(search.indexOf("=") + 1);
      console.log(id)

      $.ajax({
        type: 'GET',
        url: 'https://www.max68888.com/max/trasaction/getList/'+id,
        xhrFields: {
          withCredentials: true
        },
        success: function(res) {
          console.log(res)
          let item = res.data;
          var text = DatdIos(item.maxStartTime)+"\n"+ item.maxGameName+"<br>" +
                  item.maxHomeTeam+"<br>VS<br>"+item.maxCustomerTeam
          $('.market-info').html(text)
          // $('.market-refresh').html('成交量:'+item.trasactionSize)

          sorting(item.maxMaskTrasactionList)

          $(".market-main__time").text(item.maxStartTime)
          $(".market-main__title").text(item.maxGameName)
          $(".market-main__team").html( item.maxHomeTeam+"VS"+item.maxCustomerTeam)

        },
      })

      function sorting(data){
        $.each( data, function (i , item){

          var maxEarn = toflis(item.maxEarn)+'%'
          if(item.maxEarn == 0){
            maxEarn='----'
          }

          var box = 
                  '<div class="row m-0 d-flex table-td py-2">' +
                  '  <div class="col-2 p-0">'+item.maxScore+'</div>' +
                  '  <div class="col-3 p-0">'+ maxEarn +'</div>' +
                  '  <div class="col-3 p-0">'+ toflis(item.maxLimitTrasaction)+'</div>' +
                  '  <div class="col-4 p-0">' +
                  '   <button class="back-btn bet-table-button" data-bs-toggle="modal" ' +
                  'data-bs-target="#betModal" data-ratio="'+item.maxEarn+'" data-way="'+item.maxScore+'" ' +
                  'data-bet_id="'+item.id+'" data-max='+item.maxDataId+'>下单</button>'
                  '  </div>' +
                  '</div>'
          $('#page').append(box)
        })

      }

      function toflis(x){
        var f = parseFloat(x); // 解析一个字符串，返回一个浮点数；
        var f = Math.round(x*100)/100;
        var s = f.toString(); // 把一个逻辑值转换为字符串，并返回结果；
        var rs = s.indexOf('.'); // 返回某个指定的字符串值在字符串中首次出现的位置；如果字符串值没有出现，返回-1；
        if (rs < 0) {
          rs = s.length;
          s += '.';
        }
        while (s.length <= rs + 2) {
          s += '0';
        }
        return s
      }



    });
  </script>

  <script>
    var RATIO = 0;
    $(document).on('click', '.bet-table-button', function(){
      // data-ratio="0.01920" data-way="0 - 45646546" data-bet_id="odds-96fa4ff9-df50-462d-b435-90c3ab638f44"
      RATIO = $(this).data('ratio') /100;
      $('.bet-id').val($(this).data('bet_id'));
      $('.modal-bet-ratio').text((RATIO * 100).toFixed(2) + '%');
      $('.modal-bet-way').text($(this).data('way'));
      $('.modal-bet-amount').val('');
      $('.modal-bet-profit').text(0);
      $(".maxDataId").val($(this).data('max'))
    });


    $('.modal-bet__btn').on('click', function(){
      $('.modal-bet-amount').val($(this).data('amount'));
      $('.modal-bet-amount').trigger('change');
    });

    $('.modal-bet-amount').on('change blur',function(){
      var amount = $(this).val();
      if(amount > 0) {
        var profit = 0.9 * RATIO *  amount;
        $('.modal-bet-profit').text("$" + profit.toFixed(2));
        $('#bet-amount').text(amount);
        $('.bet-amount').val(amount);
      } else {
        $(this).val('');
      }
    });
    $('.modal-next').on('click', function(){
      if($('.modal-bet-amount').val() > 0){
        $('#betModal').modal('hide');
        $('#betCheckModal').modal('show');
      } else {
        $('.modal-bet-amount').val('');
        $('.modal-bet-amount').focus();
      }
    });

    $('#bet-form').on('submit', function(e){
      e.preventDefault();
      $('button').attr("disabled", true);
      var form = $(this);
      console.log(form.serialize())

      $.ajax({
        type: 'POST',
        data: form.serialize(),
        url: 'https://www.max68888.com/max/trasactionOrder/pickTrasaction',
        xhrFields: {
          withCredentials: true
        },
        success: function (res) {
          if(res.code == 0){
            var item =res.data
            console.log(res.data)

            $('.balance').text(item.balance);
            $('.bill-number').text(item.bill_number);
            $('.show-bet-amount').text(item.amount);
            $('.show-bet-ratio').text(item.ratio);
            $('.show-bet-profit').text(item.profit);
            $('.show-bet-profit-rmb').text((item.profit*7).toFixed(2));

            $("#gameStartTime").text(item.gameStartTime)
            $("#maxCustomerTeam").text(item.maxCustomerTeam)
            $("#maxGame").text(item.maxHomeTeam +'VS'+ item.maxGameName)
            $("#maxScore").text(item.maxScore)
            $("#amount").text(item.amount)
            $("#maxEarn").text(item.maxEarn+'%')
            $("#resultEarn").text(item.resultEarn)
            $("#resultRem").text( (item.resultEarn * 7).toFixed(2))




            $('#betCheckModal').modal('hide');
            $('#betShowModal').modal('show');
          }
          else{
            swal(res.msg, '', "error");
          }
          $('button').attr("disabled", false);
        }
      });

    });

  </script>
</body>
</html>